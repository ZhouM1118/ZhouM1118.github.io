---
layout: post
title:  "死磕JavaScript-垃圾收集机制"
date:   2017-05-18
desc: "死磕JavaScript-垃圾收集机制"
keywords: "JavaScript,垃圾收集"
categories: [Javascript]
tags: [JavaScript,垃圾收集]
icon: icon-html
---
JavaScript和Java一样具有自动垃圾收集机制。JavaScript的垃圾收集你机制的原理很简单：找出那些不再继续使用的变量，然后释放其占用的内存。

**标记清除：**这是最常用的垃圾收集方式。原理是：垃圾收集器在运行的时候会给存储在内存中的所有变量都加上标记—>然后，它会去掉环境中的变量以及被环境中的变量引用的变量的标记—>在此之后再被加上标记的变量将被视为准备删除的变量—>最后，垃圾收集器完成内存清除工作，销毁那些带标记的变量并回收它们所占用的内存空间。

**引用计数：**这是一种不太常见的垃圾收集方式，IE用的就是这种。引用计数是指追踪记录每个值被引用的次数，原理是：当声明一个变量并将一个引用类型值赋给该变量时，则这个值得引用次数初始化为1—>如果同一个值又被赋值给另一个变量，则该值的引用次数加1—>相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值得引用次数减1—>当这个值得引用次数变为0时，说明无需再访问这个变量，可以被垃圾回收机制回收。

![](http://img.mukewang.com/591d135e0001701703930115.png)

但引用计数存在循环引用的风险，循环引用指的是对象A包含一个指向对象B的指针，而对象B中也包含一个指向对象A的引用。比如：

这里例子中，objectA和objectB通过各自的属性相互引用，也就是说，两个对象的引用次数都是2，尽管函数执行完毕后，objectA和objectB还将继续存在，因为它们的引用次数永远都不为0。

IE因为采用了引用计数的垃圾收集而性能低下。

当然，我们也可以通过解除变量的引用（解除引用）来消除循环引用现象，比如：objectA = null;和objectB = null。
